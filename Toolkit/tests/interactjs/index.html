<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <!-- VENDOR -->
    <script type="text/javascript" src="../../vendor/interact.js/dist/interact.min.js"></script>

    <!-- OSH Core -->
    <script type="text/javascript" src="../../src/osh/osh-Template.js"></script>
    <!-- OSH buffer sync lib -->
    <script type="text/javascript" src="../../src/osh/osh-Utils.js"></script>
    <script type="text/javascript" src="../../src/osh/helper/osh-HtmlHelper.js"></script>

    <script type="text/javascript" src="../../src/osh/osh-BaseClass.js"></script>

    <script type="text/javascript" src="../../src/osh/exception/osh-Exception.js"></script>
    <script type="text/javascript" src="../../src/osh/osh-Asserts.js"></script>

    <script type="text/javascript" src="../../src/osh/osh-Buffer.js"></script>
    <!-- OSH controller lib -->
    <script type="text/javascript" src="../../src/osh/osh-EventMap.js"></script>
    <script type="text/javascript" src="../../src/osh/osh-EventManager.js"></script>
    <!-- OSH Video component parser -->
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector.js"></script>
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector-Websocket.js"></script>
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector-HttpAjaxConnector.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSource.js"></script>

    <!-- OSH Video component parser -->
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSource.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiverController.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoH264.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoMp4.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoMjpeg.js"></script>

    <script type="text/javascript" src="../../src/osh/ui/panel/osh-UI-Panel.js"></script>

    <script type="text/javascript" src="../../src/osh/ui/view/osh-UI-View.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-VideoView.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-MjpegView.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-Mp4View.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-FFMPEGView.js"></script>

    <link rel="stylesheet" type="text/css" href="../../src/css/osh-common.css"/>
    <script type="text/javascript" src="../../src/osh/ui/styler/osh-UI-Styler.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/styler/osh-UI-StylerVideo.js"></script>

    <style>
        body {
            margin: 0;
            height: 100%;
        }

        html {
            height: 100%;
            overflow: hidden;
        }

        #dialog-container {
            width: 100%;
            height: 80%;
        }

        .draggable {
            cursor: -webkit-grab;
            cursor: -moz-grab;
            cursor: grab;
        }

        .draggable.getting--dragged {
            cursor: -webkit-grabbing;
            cursor: -moz-grabbing;
            cursor: grabbing;
        }

        #swap-container {
            right: 0;
            width: 400px;
            height: 400px;
            background-color: blue;
            position:absolute;
            top: 0;
            overflow:auto;
            border:1px solid black;
        }

        #pin-container {
            right: 400px;
            width: 400px;
            height: 400px;
            background-color: #00A0B0;
            position:absolute;
            top: 0;
            overflow:auto;
            border:1px solid black;
        }

        #swap-container-elt {
            background-color: blue;
        }

        #fake-content {
            background-color:green;
            height: 100%;
        }

        /** DIALOG CSS **/
        .osh.dialog {
            width: 100%;
            height: 100%;
        }

        .osh.dialog {
            width: 290px;
            height: 300px;
            background-color: #29e;
            color: white;
            box-sizing: border-box;
            background: radial-gradient(rgba(161, 222, 240, 0.75), rgba(64, 129, 147, 0.75));
            border: 1px solid #bbbbbb;
            border-radius: 6px;
            box-shadow: 3px -4px 7px 0px rgba(0, 0, 0, 0.54);
            z-index: 1020;
            -webkit-transform: translate(0px, 0px);
            transform: translate(0px, 0px);
            display: flex;
            flex-direction: column;
        }

        .osh.dialog .dialog-header {
            height: 25px;
            background: red;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            padding-right:5px;
            padding-bottom: 4px;
            font-size: 16px;
            font-weight: bold;
            flex:0;
        }

        .osh.dialog .dialog-header > .line-left {
            float: left;
            padding-left: 15px;
            padding-top: 4px;
        }

        .osh.dialog .dialog-header > .line-right {
            float: right;
        }

        .osh.dialog .dialog-content {
            background: yellow;
            height: calc(100% - 50px); /* 25px of the header + 25px of the footer*/
            overflow: auto;
            flex: 1 auto;
        }

        .osh.dialog .dialog-content div {
            height:100%;
            width:100%;
        }

        .osh.dialog .dialog-footer {
            min-height: 25px;
            background: black;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
            flex:2;
        }

        .osh.dialog .dialog-header-icon {
            display: inline-block;
            font-family: FontAwesome;
            cursor: pointer;
            color: #c3c3c3;
        }

        .osh.dialog .dialog-header-icon:hover {
            color: #676767;
            cursor:pointer;
        }

        .osh.dialog .dialog-header-icon.icon-selected {
            color: #676767;
        }


        .osh.dialog .minimized {
            height: 25px !important;
            transition: height 0.25s ease-out;
            -webkit-transition: height 0.25s ease-out;
            -moz-transition: height 0.25s ease-out;
            -o-transition: height 0.25s ease-out;
            -ms-transition: height 0.25s ease-out;
        }

        .osh.dialog.closed {
            display:none !important;
        }

        .osh.dialog .minimized .dialog-header {
            border-radius: 6px;
        }

        /** MODAL PART **/
        .osh.dialog.modal {
            position: relative;
            pointer-events: none;
            width: 100%;
            height: 100%;
        }

        .osh.dialog.modal-block {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0,0,0,0.6);
            z-index: 99999;
            opacity: 1;
        }

        .modal-allow {
            pointer-events: auto;
        }

        /** ICON**/
        .icon-swap:before {
            content:"\f0ec";
        }

        .icon-pin:before {
            content: "\f08d";
        }

        .icon-minimize:before {
            content: "\f2d1";
        }

        .icon-restore:before {
            content: "\f2d2";
        }

        .icon-close {
            margin-top:2px;
        }

        .icon-close:before {
            content: "\f00d";
            font-size: 19px;
        }
    </style>
</head>
<body id="body">
<div id="dialog-container"></div>
<div id="swap-container">
    <div id="swap-container-elt"></div>
</div>

<div id="pin-container">
</div>
<script type="text/javascript">

    /**
     * @classdesc
     * @class
     * @type {OSH.UI.Panel}
     * @augments OSH.UI.Panel
     * @example
     var dialogPanel =  new OSH.UI.Panel.DialogPanel(containerDivId, {
        pinContainerId: "pin-container",
        swapContainerId: "main-container",
        title: title,
        show:false,
        css: "dialog",
        draggable: false,
        resizable: true,

        closeable: true,
        connectionIds : dataSources ,
        destroyOnClose: true,
        modal: false
    });
     */
    OSH.UI.Panel.NewDialogPanel = OSH.UI.Panel.extend({
        initialize: function (parentElementDivId, options) {
            this._super(parentElementDivId, options);
        },

        initPanel: function () {
            // adds OSH css
            OSH.Utils.addCss(this.elementDiv, "dialog");

            // creates header
            this.headerElt = this.createHeader();

            // creates content
            this.contentElt = this.createContent();

            // creates footer
            this.footerElt = this.createFooter();

            this.parentElementDiv = this.elementDiv.parentNode;

            this.elementDiv.appendChild(this.headerElt);
            this.elementDiv.appendChild(this.contentElt);
            this.elementDiv.appendChild(this.footerElt);

            this.initDragAndDrop(this.elementDiv);

            this.updateProperties(this.options);
        },

        /**
         * Check properties
         * @param properties the new properties
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        checkOptions:function(properties) {
            if(!isUndefinedOrNull(properties)) {
                // checks title
                if (!isUndefined(properties.title)) {
                    this.title = properties.title;
                } else if(isUndefinedOrNull(this.title)) {
                    this.title = "Untitled"; // default value
                }

                // checks show
                if (!isUndefined(properties.show)) {
                    this.show = properties.show;
                } else if(isUndefinedOrNull(this.show)) {
                    this.show = true; // default value
                }

                // checks draggable
                if (!isUndefined(properties.draggable)) {
                    this.draggable = properties.draggable;
                } else if(isUndefinedOrNull(this.draggable)) {
                    this.draggable = true; // default value
                }

                // checks resizable
                if (!isUndefined(properties.resizable)) {
                    this.resizable = properties.resizable;
                } else if(isUndefinedOrNull(this.resizable)) {
                    this.resizable = true; // default value
                }

                // checks closeable
                if (!isUndefined(properties.closeable)) {
                    this.closeable = properties.closeable;
                } else if(isUndefinedOrNull(this.closeable)) {
                    this.closeable = true; // default value
                }

                // checks connected & connectionIds
                if (!isUndefined(properties.connectionIds)) {
                    this.connectionIds = properties.connectionIds;
                    this.connected = true;
                } else if(isUndefinedOrNull(this.connectionIds)) {
                    this.connected = false;  // default value
                    this.connectionIds = []; // default value
                }

                // checks pin
                if (!isUndefined(properties.pinContainerId)) {
                    this.pin = {
                        containerId: this.options.pinContainerId,
                        originalContainerId: this.parentElementDiv.id,
                        lastPosition: {
                            x: 0,
                            y: 0
                        }
                    }
                } else if(isUndefinedOrNull(this.pin)) {
                    this.pin = null; // default value
                }

                // checks swap
                if (!isUndefined(properties.swapContainerId)) {
                    var dstElt = document.getElementById(properties.swapContainerId);
                    if (!isUndefinedOrNull(dstElt)) {
                        var parentDstElt = dstElt.parentNode;
                        if (!isUndefinedOrNull(parentDstElt)) {
                            this.swap = {
                                swapContainerId: properties.swapContainerId,
                                position: window.getComputedStyle(dstElt).getPropertyValue('position')
                            }
                        }
                    }
                } else if(isUndefinedOrNull(this.swap)) {
                    this.swap = null; // default value
                }

                // checks destroy on close
                if (!isUndefined(properties.destroyOnClose)) {
                    this.destroyOnClose = properties.destroyOnClose;
                } else if(isUndefinedOrNull(this.destroyOnClose)) {
                    this.destroyOnClose = false; // default value
                }

                // checks modal
                if (!isUndefined(properties.modal)) {
                    this.modal = properties.modal;
                } else if(isUndefinedOrNull(this.modal)) {
                    this.modal = false; // default value
                }
            }

            this.minimized = false;
        },

        //------- HEADER ---------------//
        /**
         * Init handler
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        createHeader: function () {
            var dialogHeaderElt = document.createElement("div");
            dialogHeaderElt.setAttribute("class", "dialog-header");

            // creates line
            // // Left element
            this.headerSpanLeftElt = document.createElement("span");
            this.headerSpanLeftElt.setAttribute("class","line-left");

            // // Right element
            var tableRightElt = document.createElement("table");
            tableRightElt.setAttribute("class","line-right");
            var tbodyElt = document.createElement("tbody");
            this.headerTrElt = document.createElement("tr");

            this.headerTdElts = {};

            tbodyElt.appendChild(this.headerTrElt);
            tableRightElt.appendChild(tbodyElt);

            dialogHeaderElt.appendChild(this.headerSpanLeftElt);
            dialogHeaderElt.appendChild(tableRightElt);

            return dialogHeaderElt;
        },

        /**
         * Update the dialog properties using new properties
         * @param properties the new properties
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        updateProperties:function(properties) {
            this.checkOptions(properties);

            this.headerSpanLeftElt.innerHTML = this.title;

            if(!isUndefinedOrNull(this.swap) && isUndefinedOrNull(this.headerTrElt.swap)) {
                this.headerTrElt.swap = this.addSwapIcon(this.headerTrElt);
            }

            if(!this.modal && !isUndefinedOrNull(this.pin) && isUndefinedOrNull(this.headerTrElt.pin)) {
                this.headerTrElt.pin = this.addPinIcon(this.headerTrElt);
                this.pin.position = window.getComputedStyle(this.interact.target).getPropertyValue('position');
            }

            if(isUndefinedOrNull(this.headerTrElt.minimize)) {
                this.headerTrElt.minimize = this.addMinimizeIcon(this.headerTrElt);
            }

            if((!isUndefinedOrNull(this.closeable) && this.closeable) && isUndefinedOrNull(this.headerTrElt.closeable)) {
                this.headerTrElt.closeable = this.addCloseIcon(this.headerTrElt);
            }

            this.setModal(this.modal);
            this.setVisible(this.show);
            this.interact.draggable(this.draggable);
            this.interact.resizable(this.resizable);
        },

        /**
         * Add swap icon to the parent element
         * @param parentElt the parent element to add the icon
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        addSwapIcon:function(parentElt) {
            // adds swap icon
            var tdElt = document.createElement("td");

            var swapIconElt = document.createElement("i");
            swapIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-swap");

            tdElt.appendChild(swapIconElt);
            parentElt.appendChild(tdElt);

            // adds listener
            this.addListener(swapIconElt,"click",this.swapHandler.bind(this));

            return swapIconElt;
        },

        /**
         * Add pin icon to the parent element
         * @param parentElt the parent element to add the icon
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        addPinIcon:function(parentElt) {
            // adds pin icon
            var tdElt = document.createElement("td");

            var pinIconElt = document.createElement("i");
            pinIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-pin");

            tdElt.appendChild(pinIconElt);
            parentElt.appendChild(tdElt);


            // adds listener
            this.addListener(pinIconElt,"click",this.pinHandler.bind(this));

            return pinIconElt;
        },

        /**
         * Add minimize icon to the parent element
         * @param parentElt the parent element to add the icon
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        addMinimizeIcon:function(parentElt) {
            // adds minimize icon
            var tdElt = document.createElement("td");

            var minimizeIconElt = document.createElement("i");
            minimizeIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-minimize");

            tdElt.appendChild(minimizeIconElt);
            parentElt.appendChild(tdElt);

            // adds listener
            this.addListener(minimizeIconElt,"click",this.minimizeHandler.bind(this));

            return minimizeIconElt;
        },

        /**
         * Add close icon to the parent element
         * @param parentElt the parent element to add the icon
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        addCloseIcon:function(parentElt) {
            // adds minimize icon
            var tdElt = document.createElement("td");

            var closeIconElt = document.createElement("i");
            closeIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-close");

            tdElt.appendChild(closeIconElt);
            parentElt.appendChild(tdElt);

            // adds listener
            this.addListener(closeIconElt,"click",this.closeHandler.bind(this));

            return closeIconElt;
        },

        setModal:function(isModal) {
            if(isModal) {
                OSH.Utils.addCss(this.elementDiv,"modal-block");
            } else {
                // current dialog is modal, make it non-modal
                OSH.Utils.removeCss(this.elementDiv,"modal-block");
            }
        },

        //------- END HEADER ---------------//

        /**
         * Create the content
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        createContent: function () {
            var dialogContentElt = document.createElement("div");
            dialogContentElt.setAttribute("class", "dialog-content");

            return dialogContentElt;
        },

        /**
         * Create the footer
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        createFooter: function () {
            var dialogFooterElt = document.createElement("div");
            dialogFooterElt.setAttribute("class", "dialog-footer");

            return dialogFooterElt;
        },

        /**
         * Init drag and drop
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        initDragAndDrop: function (element) {
            this.interact = interact(element)
                .draggable({
                    // enable inertial throwing
                    inertia: true,
                    // keep the element within the area of it's parent
                    restrict: {
                        restriction: "parent",
                        endOnly: false,
                        elementRect: {top: 0, left: 0, bottom: 1, right: 1}
                    },
                    // enable autoScroll
                    autoScroll: true,

                    // call this function on every dragmove event
                    onmove: dragMoveListener,
                    // call this function on every dragend event
                    onend: function (event) {
                    }
                })
                .resizable({
                    preserveAspectRatio: true,
                    edges: {left: true, right: true, bottom: true, top: true},
                    margin: 10
                })
                .on('resizemove', function (event) {
                    var target = event.target,
                        x = (parseFloat(target.getAttribute('data-x')) || 0),
                        y = (parseFloat(target.getAttribute('data-y')) || 0);

                    // update the element's style
                    target.style.width = event.rect.width + 'px';
                    target.style.height = event.rect.height + 'px';

                    // translate when resizing from top or left edges
                    x += event.deltaRect.left;
                    y += event.deltaRect.top;

                    target.style.webkitTransform = target.style.transform =
                        'translate(' + x + 'px,' + y + 'px)';

                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);
                });

            var self = this;

            function dragMoveListener(event) {
                var target = event.target,
                    // keep the dragged position in the data-x/data-y attributes
                    x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
                    y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                target.style.webkitTransform =
                    target.style.transform =
                        'translate(' + x + 'px, ' + y + 'px)';

                target.setAttribute('data-x', x);
                target.setAttribute('data-y', y);
            }

            // this is used later in the resizing and gesture demos
            window.dragMoveListener = dragMoveListener;
        },

        //------------ HANDLERS -----------------//
        /**
         * Handler for the swap event
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        swapHandler:function() {
            // swap only content
            if(!isUndefinedOrNull(this.swap)) {
                this.swapWith(this.swap.swapContainerId)
            }
        },

        /**
         * Handler for the pin event
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        pinHandler:function() {
            var parentId = this.elementDiv.parentNode.id;

            if(parentId === this.pin.containerId) {
                // unpin: dialog -> original container
                this.unpin();
            } else {
                // pin: dialog -> dest container
                this.pinTo(this.pin.containerId);
            }
        },

        /**
         * Handler for the minimize event
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        minimizeHandler:function() {
            if(!this.minimized) {
                this.minimize();
            } else {
                this.restore();
            }
        },

        /**
         * Handler for the close event
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        closeHandler:function() {
            this.close();
        },

        connectDataSourceHandler:function() {
            if (this.connected) {
                OSH.EventManager.fire(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE, {dataSourcesId: this.connectionIds});
            } else {
                OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE, {dataSourcesId: this.connectionIds});
            }

            this.connected = !this.connected;
        },

        //---------- FUNCTIONS ----------------//
        /**
         * Swap the dialog with another div
         * @param dstContainerId the div to swap with
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        swapWith:function(dstContainerId) {
            // removes content from dst
            var dstContainerElt = document.getElementById(dstContainerId);
            OSH.Asserts.checkIsDefineOrNotNull(dstContainerElt);

            // removes content from dst container
            var childrenDst = [];
            var i;
            for(i=0;i < dstContainerElt.children.length;i++) {
                childrenDst.push(dstContainerElt.removeChild(dstContainerElt.children[i]));
            }

            // removes content from dialog
            var childrenDialog = [];
            for(i=0;i < this.contentElt.children.length;i++) {
                childrenDialog.push(this.contentElt.removeChild(this.contentElt.children[i]));
            }

            // swap
            for(i=0;i < childrenDialog.length;i++) {
                dstContainerElt.appendChild(childrenDialog[i]);
            }

            for(i=0;i < childrenDst.length;i++) {
                this.contentElt.appendChild(childrenDst[i]);
            }

            /*  // overrides any position because it has to be relative
             firstRemovedElt.style.position = "relative";

             // applies saved position
             secondRemovedElt.style.position = this.swap.position;*/
        },

        /**
         * Pin the dialog.
         * @param containerId the parent element container id to pin the dialog into
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        pinTo:function(containerId) {
            if(!this.modal) {
                OSH.Asserts.checkIsDefineOrNotNull(this.interact);
                OSH.Asserts.checkIsDefineOrNotNull(this.interact.target);

                this.parentElementDiv.removeChild(this.elementDiv);

                var dstContainerElt = document.getElementById(containerId);
                OSH.Asserts.checkIsDefineOrNotNull(dstContainerElt);

                dstContainerElt.appendChild(this.elementDiv); //TODO: needs to store index?

                this.interact.draggable(false);

                // store last position
                this.pin.lastPosition.x = (parseFloat(this.interact.target.getAttribute('data-x')) || 0);
                this.pin.lastPosition.y = (parseFloat(this.interact.target.getAttribute('data-y')) || 0);

                // set dst position
                this.setPosition(0, 0);
                this.interact.target.style.position = "relative";

                OSH.Utils.addCss(this.headerTrElt.pin, "icon-selected");
            }
        },

        /**
         * Unpin the dialog
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        unpin:function() {
            if(!this.modal) {
                OSH.Asserts.checkIsDefineOrNotNull(this.interact);
                OSH.Asserts.checkIsDefineOrNotNull(this.interact.target);

                this.elementDiv.parentNode.removeChild(this.elementDiv);

                var originalContainerElt = document.getElementById(this.pin.originalContainerId);
                OSH.Asserts.checkIsDefineOrNotNull(originalContainerElt);

                originalContainerElt.appendChild(this.elementDiv); //TODO: needs to store index?
                this.interact.draggable(this.draggable);

                // restore position before pinning
                this.setPosition(this.pin.lastPosition.x, this.pin.lastPosition.y);

                // restore style before pinning
                OSH.Asserts.checkIsDefineOrNotNull(this.pin.position);
                this.interact.target.style.position = this.pin.position;

                OSH.Utils.removeCss(this.headerTrElt.pin, "icon-selected");
            }
        },

        /**
         * Minimize the dialog
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        minimize:function() {
            OSH.Utils.addCss(this.elementDiv,"minimized");
            OSH.Utils.addCss(this.contentElt,"hide");
            OSH.Utils.addCss(this.footerElt,"hide");

            OSH.Utils.replaceCss(this.headerTrElt.minimize,"icon-minimize","icon-restore");
            this.minimized = true;
            this.interact.resizable(false);
        },

        /**
         * Restore the dialog after minimizing
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        restore:function() {
            OSH.Utils.removeCss(this.elementDiv,"minimized");
            OSH.Utils.removeCss(this.contentElt,"hide");
            OSH.Utils.removeCss(this.footerElt,"hide");

            OSH.Utils.replaceCss(this.headerTrElt.minimize,"icon-restore","icon-minimize");
            this.minimized = false;
            this.interact.resizable(this.draggable);
        },

        /**
         *
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        onClose: function () {},

        /**
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        close: function () {
            if(this.destroyOnClose) {
                this.parentElementDiv.removeChild(this.elementDiv);
            } else {
                this.setVisible(false);
            }
            this.onClose();
        },

        /**
         * Set the dialog position to x,y pixel coordinates
         * @instance
         * @memberof OSH.UI.Panel.DialogPanel
         */
        setPosition:function(x,y) {
            this.interact.target.style.webkitTransform =
                this.interact.target.style.transform =
                    'translate(' + x + 'px, ' + y + 'px)';

            this.interact.target.setAttribute('data-x', x);
            this.interact.target.setAttribute('data-y', y);
        }
    });

    var dialog = new OSH.UI.Panel.NewDialogPanel("dialog-container",{
        title: "Non modal 1",
        swapContainerId:"swap-container",
        pinContainerId: "swap-container",
        destroyOnClose:true,
        modal:false
    });

    // test for swapping
    var div = document.createElement("div");
    div.setAttribute("id","fake-content");

    dialog.contentElt.appendChild(div);



    // test for swapping

    /*setTimeout(function () {
     dialog2.pinTo("pin-container");
     dialog2.swapWith("swap-container");

     setTimeout(function () {
     dialog2.unpin();
     dialog2.swapWith("swap-container");
     dialog2.updateProperties({
     resizable:true,
     draggable:true
     });
     },2000);
     },2000);*/
    // display the dialog after closing
    dialog.onClose = function() {
        setTimeout(function () {
            OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW+"-"+dialog.divId,{show: true});
        },1000);
    };

    var replayFactor = 3;

    //---------- DATASOURCE ------------//
    var androidPhoneVideoDataSource = new OSH.DataReceiver.VideoMjpeg("android-Video", {
        protocol: "ws",
        service: "SOS",
        endpointUrl: "sensiasoft.net:8181/sensorhub/sos",
        offeringID: "urn:android:device:060693280a28e015-sos",
        observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
        startTime: "2015-02-16T07:58:00Z",
        endTime: "2015-02-16T08:09:00Z",
        replaySpeed: replayFactor + "",
        syncMasterTime: false,
        bufferingTime: 200
    });

    //------------ VIEW -----------------//

    var dialog2 = new OSH.UI.Panel.NewDialogPanel("dialog-container",{
        title: "Modal 2",
        swapContainerId:"swap-container",
        pinContainerId: "swap-container",
        show:true,
        draggable:false,
        resizable:false,
        closeable:true,
        modal:true,
        connectionIds:[androidPhoneVideoDataSource.id]
    });

    // Video 1 View
    var videoView = new OSH.UI.View.MjpegView("",
        [
            {
                name: "video view item",
                styler: new OSH.UI.Styler.Video({
                    frameFunc: {
                        dataSourceIds: [androidPhoneVideoDataSource.id],
                        handler: function (rec, timestamp, options) {
                            return rec;
                        }
                    }
                })
            }
        ]
        , {
            css: "video-mjpeg",
            cssSelected: "video-selected",
            name: "Android Video",
            keepRatio: true
        });

    videoView.attachToElement(dialog2.contentElt);
    //---------------------------------------------------------------//
    //--------------------- Creates DataProvider --------------------//
    //---------------------------------------------------------------//

    var dataProviderController = new OSH.DataReceiver.DataReceiverController({
        replayFactor: replayFactor
    });

    // We can add a group of dataSources and set the options
    dataProviderController.addDataSource(androidPhoneVideoDataSource);

    //---------------------------------------------------------------//
    //---------------------------- Starts ---------------------------//
    //---------------------------------------------------------------//

    // starts streaming
    dataProviderController.connectAll();

    // some tests on dialog
    dialog2.pinTo("pin-container");
    dialog2.swapWith("swap-container");
    dialog2.swapWith("swap-container");

    dialog2.updateProperties({
        resizable:true,
        draggable:true
    });

    var button = document.createElement("input");
    button.setAttribute("type","button");
    button.setAttribute("value","click me");
    document.body.appendChild(button);
</script>

</body>
</html>