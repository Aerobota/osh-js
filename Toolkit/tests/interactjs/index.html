<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <!-- VENDOR -->
    <script type="text/javascript" src="../../vendor/interact.js/dist/interact.min.js"></script>

    <!-- OSH Core -->
    <script type="text/javascript" src="../../src/osh/osh-Template.js"></script>
    <!-- OSH buffer sync lib -->
    <script type="text/javascript" src="../../src/osh/osh-Utils.js"></script>
    <script type="text/javascript" src="../../src/osh/helper/osh-HtmlHelper.js"></script>

    <script type="text/javascript" src="../../src/osh/osh-BaseClass.js"></script>

    <script type="text/javascript" src="../../src/osh/exception/osh-Exception.js"></script>
    <script type="text/javascript" src="../../src/osh/osh-Asserts.js"></script>

    <script type="text/javascript" src="../../src/osh/osh-Buffer.js"></script>
    <!-- OSH controller lib -->
    <script type="text/javascript" src="../../src/osh/osh-EventMap.js"></script>
    <script type="text/javascript" src="../../src/osh/osh-EventManager.js"></script>
    <!-- OSH Video component parser -->
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector.js"></script>
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector-Websocket.js"></script>
    <script type="text/javascript" src="../../src/osh/dataconnector/osh-DataConnector-HttpAjaxConnector.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSource.js"></script>

    <!-- OSH Video component parser -->
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSource.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiverController.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoH264.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoMp4.js"></script>
    <script type="text/javascript" src="../../src/osh/datareceiver/osh-DataReceiver-DataSourceVideoMjpeg.js"></script>

    <script type="text/javascript" src="../../src/osh/ui/panel/osh-UI-Panel.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/panel/dialog/osh-UI-DialogPanel.js"></script>

    <script type="text/javascript" src="../../src/osh/ui/view/osh-UI-View.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-VideoView.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-MjpegView.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-Mp4View.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/view/video/osh-UI-FFMPEGView.js"></script>

    <link rel="stylesheet" type="text/css" href="../../src/css/osh-common.css"/>
    <link rel="stylesheet" type="text/css" href="../../src/css/osh-dialog.css"/>
    <script type="text/javascript" src="../../src/osh/ui/styler/osh-UI-Styler.js"></script>
    <script type="text/javascript" src="../../src/osh/ui/styler/osh-UI-StylerVideo.js"></script>

    <style>
        body {
            margin: 0;
            height: 100%;
        }

        html {
            height: 100%;
            overflow: hidden;
        }

        #dialog-container {
            width: 100%;
            height: 100%;
        }

        .draggable {
            cursor: -webkit-grab;
            cursor: -moz-grab;
            cursor: grab;
        }

        .draggable.getting--dragged {
            cursor: -webkit-grabbing;
            cursor: -moz-grabbing;
            cursor: grabbing;
        }

        #swap-container {
            right: 0;
            width: 400px;
            height: 400px;
            background-color: blue;
            position:absolute;
            top: 0;
            overflow:auto;
            border:1px solid black;
        }

        #pin-container {
            right: 400px;
            width: 400px;
            height: 400px;
            background-color: #00A0B0;
            position:absolute;
            top: 0;
            overflow:auto;
            border:1px solid black;
        }

        #swap-container-elt {
            background-color: blue;
        }

        #fake-content {
            background-color:green;
            height: 100%;
        }

        .dialog-test {
            width:290px;
            min-height:200px;
        }
    </style>
</head>
<body id="body">
<div id="dialog-container"></div>
<div id="swap-container">
    <div id="swap-container-elt"></div>
</div>

<div id="pin-container">
</div>
<script type="text/javascript">

    var dialog = new OSH.UI.Panel.DialogPanel("dialog-container",{
        title: "Non modal 1",
        swapContainerId:"swap-container",
        pinContainerId: "swap-container",
        destroyOnClose:true,
        modal:false,
        css:"dialog-test"
    });

    // test for swapping
    var div = document.createElement("div");
    div.setAttribute("id","fake-content");

    dialog.contentElt.appendChild(div);


    // test for swapping

    /*setTimeout(function () {
        dialog2.pinTo("pin-container");
        dialog2.swapWith("swap-container");

        setTimeout(function () {
            dialog2.unpin();
            dialog2.swapWith("swap-container");
            dialog2.updateProperties({
                resizable:true,
                draggable:true
            });
        },2000);
    },2000);*/
    // display the dialog after closing
    dialog.onClose = function() {
        setTimeout(function () {
            OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW+"-"+dialog.divId,{show: true});
        },1000);
    };

        var replayFactor = 3;

        //---------- DATASOURCE ------------//
        var androidPhoneVideoDataSource = new OSH.DataReceiver.VideoMjpeg("android-Video", {
            protocol: "ws",
            service: "SOS",
            endpointUrl: "sensiasoft.net:8181/sensorhub/sos",
            offeringID: "urn:android:device:060693280a28e015-sos",
            observedProperty: "http://sensorml.com/ont/swe/property/VideoFrame",
            startTime: "2015-02-16T07:58:00Z",
            endTime: "2015-02-16T08:09:00Z",
            replaySpeed: replayFactor + "",
            syncMasterTime: false,
            bufferingTime: 200
        });

        //------------ VIEW -----------------//

        var dialog2 = new OSH.UI.Panel.DialogPanel("dialog-container",{
            title: "Modal 2",
            swapContainerId:"swap-container",
            pinContainerId: "swap-container",
            show:true,
            draggable:false,
            resizable:false,
            closeable:true,
            modal:true,
            connectionIds:[androidPhoneVideoDataSource.id],
            css:"dialog-test",
            keepRatio:true
        });

        // Video 1 View
        var videoView = new OSH.UI.View.MjpegView("",
            [
                {
                    name: "video view item",
                    styler: new OSH.UI.Styler.Video({
                        frameFunc: {
                            dataSourceIds: [androidPhoneVideoDataSource.id],
                            handler: function (rec, timestamp, options) {
                                return rec;
                            }
                        }
                    })
                }
            ]
            , {
                css: "video-mjpeg",
                cssSelected: "video-selected",
                name: "Android Video",
                keepRatio: true
            });

        videoView.attachToElement(dialog2.contentElt);
        //---------------------------------------------------------------//
        //--------------------- Creates DataProvider --------------------//
        //---------------------------------------------------------------//

        var dataProviderController = new OSH.DataReceiver.DataReceiverController({
            replayFactor: replayFactor
        });

        // We can add a group of dataSources and set the options
        dataProviderController.addDataSource(androidPhoneVideoDataSource);

        //---------------------------------------------------------------//
        //---------------------------- Starts ---------------------------//
        //---------------------------------------------------------------//

        // starts streaming
        dataProviderController.connectAll();

        // some tests on dialog
        dialog2.pinTo("pin-container");
        dialog2.swapWith("swap-container");
        dialog2.swapWith("swap-container");

        dialog2.updateProperties({
            resizable:true,
            draggable:true
        });
</script>

</body>
</html>